# Reliable Euler deconvolution estimates throughout the vertical derivatives in the sensitivity matrix 

by Felipe F. Melo (Observatório Nacional) and Valéria C. F. Barbosa (Observatório
Nacional) (2019)

Email: felipe146@hotmail.com (F.F. Melo); valcris@on.br (V.C.F. Barbosa) 

This repository contains a collection of Python codes and synthetic data 
example for a paper about the open-source package Euler deconvolution.The 
example data reproduce the synthetc results and figures shown in the publication.
The Euler deconvolution package `euler_python.py` is compatible with Python 2.7
and 3.7 programming language. To run the program,the numpy library is required. 
In addition, numpy is to run the complementary codes for the tests `estimates_statistics.py`
and the matplotlib is required to run the scripts `plot_functions.py` and `synthetic_test.py`.

1 - Abstract

2 - Content

3 - Prerequisites

4 - Running the files

5 - License

===============================================================================


1 - Abstract
----------------------
We propose a novel methodology to select reliable Euler deconvolution estimates throughout the vertical derivatives in the sensitivity matrix. For each moving data window, we compute the standard deviation of the vertical derivatives in the sensitivity matrix. The moving data windows with the largest standard deviations of the vertical derivatives define the location of the sources and thus reliable estimates. Traditionally, for each tentative structural index (SI), the horizontal coordinates estimates obtained for each position of a moving data window are plotted in the plan view of the study area and the depth estimates are represented by different colors. Therefore, in our methodology, the estimates with tight clustering define the correct SI. Furthermore, we plot the horizontal coordinates estimates obtained for each position of a moving data window in the plan view of the study area and the base-level estimates represented by different colors in order to analyze these estimates when the correct SI is used. We prove the success of our methodology in two scenarios. First, four sources with distinct SI generate the total-field anomaly that is corrupted by an additive nonlinear background. This background strongly interfere the anomalies, changing their amplitude and shape. Second, we simulate two nearby sources generating a strongly interfering anomaly. In this case, the resulting anomaly is not visually distinguishable as generated by more than one source. In both cases, our methodology correctly defines the SIs and the depths of the causative sources. We apply our methodology to the real magnetic anomaly of Anitápolis, Brazil, and we may infer that a plug generates the Anitápolis anomaly.


2 - Content
----------------------

Both synthetic tests can be reproduced with this codes. The test 1 can be reproduced from the folder
`test_4_sources` and the test 2 can be reproduced from the folder `test_2_sources`.

Python codes:

	- euler_python.py
		General Python module containing the functions to compute de derivatives and Euler deconvolution.
	
	- synthetic_test.py
		Python script to generate the synthetic results. The script loads the total-field
		anomaly of a synthetic model from the file "synthetic_data.dat" and computes the
		Euler deconvolution using the functions in "euler_python.py". The results are 
		generated using the functions "plot_functions.py" for the plots and 
		"estimates_statistics.py" to compute the statistics of the data. 
		
	- plot_functions.py:
		Python script to generate the figures in the synthetic tests results. 
	
	- estimates_statistics.py:
		Python script to compute the mean of the depth estimates. 
	
Outputs: 
 
	- figures - all figures that generated the synthetic example in the manuscript will be saved
			in this folder. The figures generated may differ from the publication and
			can be adapted in the script `plot_functions.py`.
						 
	- results - the mean of the depth estimates over the selected areas.

Test data:

	- input/synthetic_data.dat
		Synthetic magnetic data generated using the Python packaged "Fatiando a Terra":	
		http://fatiando.org/. This data is an example used in the current publication.
		
	- input/Linear_L_0-1.txt
		A colormap scale to plot the magnetic data and b-estimates (Niccoli, 2014).

3 - Prerequisites
----------------------
The Python program Euler deconvolution - `euler_python.py` and the script `estimates_statistics.py` requires 
the Python library "numpy" and the scripts `synthetic_python.py` and `plot_functions.py` requires the Python
packages "numpy" and "matplotlib". 
The easier way to get Python and all libraries installed is through the Anaconda Python 
distribution (https://www.anaconda.com/distribution/). After installed Anaconda, install the libraries 
by running the following command in your terminal:

	conda install numpy matplotlib

The program for Euler deconvolution `euler_python.py` and the algorithm `synthetic_python.py`
 are compatible with both Python 2.7 and 3.7.

4 - Running the files
----------------------
After Anaconda and the libraries are installed, you need to run 
the code `synthetic_python.py` to generate the results.
There are two easy ways to run the synthetic test `synthetic_python.py`

1. Via command line: 

	1.1 On linux based systems open the command prompt windows (terminal), and run the command:
	
	On Python 2.7: python synthetic_python.py 
	On Python 3.7: python3 synthetic_python.py 

	1.2 On windows based systems open the Iphyton console (Python 2.7) or 
	Anaconda Navigator and then Jupyter QtConsole (Python 3.7), and run the command:

	run synthetic_python.py

2. Open the Spyder program that comes with the Ananconda installation. In the Spyder, open
the example script "synthetic_python.py" and click in "play" inside the Spyder to execute it.

If everything runs ok, the figures and results shown in the publication will be saved, respectively,
on the folders: `/figures` and `/results`.

The  module `euler_python.py` can be imported to an interactive Python session or called from
an external Python module. The functionalities are documented using standard Python
docstrings.

The file `synthetic_python.py` is a Python-based command line script. By using this 
script, the figures and results of the synthetic test presented in the publication can be reproduced.
The figures generated may differ from the publication and can be adapted in the script `plot_functions.py`.


5 - License
----------------------
The following legal note is restricted solely to the content of the named files. It cannot
overrule licenses from the Python standard distribution modules, which are imported and
used therein.

The `euler_python.py`, `synthetic_python.py`, `plot_functions.py` and `estimates_statistics.py`
files are distributed under the following license agreement:

BSD 3-clause license

Copyright (c) 2019 Felipe F. Melo and Valéria C.F. Barbosa.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

* Redistributions of source code must retain the above copyright notice,
  this list of conditions and the following disclaimer.
* Redistributions in binary form must reproduce the above copyright notice,
  this list of conditions and the following disclaimer in the documentation
  and/or other materials provided with the distribution.
* Neither the names of the copyright holders nor the names of any contributors
  may be used to endorse or promote products derived from this software
  without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
